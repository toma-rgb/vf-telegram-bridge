<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Meeting</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        #calendly-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="calendly-container" style="width:100%; height:100%;"></div>

    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js"></script>
    <script type="text/javascript">
        window.addEventListener('load', function () {
            // Initialize Telegram Web App
            const tg = window.Telegram.WebApp;
            if (tg && typeof tg.expand === 'function') {
                tg.expand(); // Expand to full height
            }

            // Get the Calendly URL from the query string (passed by the bot)
            const urlParams = new URLSearchParams(window.location.search);
            const calendlyUrl = urlParams.get('url') || 'https://calendly.com/goldenhorizon-test/new-meeting';

            // Check if Calendly is defined (safety against loading issues)
            if (typeof Calendly !== 'undefined') {
                Calendly.initInlineWidget({
                    url: calendlyUrl,
                    parentElement: document.getElementById('calendly-container'),
                    prefill: {},
                    utm: {}
                });
            } else {
                console.error("Calendly script not loaded properly.");
                // Fallback: try to re-initialize after a short delay if it's slow
                setTimeout(() => {
                    if (typeof Calendly !== 'undefined') {
                        Calendly.initInlineWidget({
                            url: calendlyUrl,
                            parentElement: document.getElementById('calendly-container')
                        });
                    }
                }, 1000);
            }
        });

        // Optional: Notify the bot when booking is done
        // Note: Calendly doesn't easily notify parent about success in an inline widget 
        // without their Enterprise/Pro event listeners, but we can listen for some events.
        function isCalendlyEvent(e) {
            return e.data.event && e.data.event.indexOf('calendly') === 0;
        };

        window.addEventListener('message', function (e) {
            if (isCalendlyEvent(e)) {
                console.log("Calendly event:", e.data.event);
                if (e.data.event === 'calendly.event_scheduled') {
                    // You could close the web app here or show a success message
                    // window.Telegram.WebApp.close();
                }
            }
        });
    </script>
</body>

</html>